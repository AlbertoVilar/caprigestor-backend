<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Genealogia - CapriGestor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
        }
        
        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            flex: 1;
            min-width: 150px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        button.secondary:hover {
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        button.danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        button.danger:hover {
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.3);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .token-display {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 11px;
            word-break: break-all;
        }
        
        .animal-examples {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .animal-examples h3 {
            margin-top: 0;
            color: #856404;
        }
        
        .animal-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .animal-item {
            background: white;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .animal-item:hover {
            background-color: #f0f0f0;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #4CAF50;
            text-decoration: none;
            font-weight: 500;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">‚Üê Voltar ao Menu Principal</a>
        
        <h1>üß¨ Teste de Genealogia</h1>
        
        <div class="animal-examples">
            <h3>Animais do Capril Vilar Dispon√≠veis:</h3>
            <div class="animal-list">
                <div class="animal-item" onclick="setAnimal('1643218012')">
                    <strong>1643218012</strong><br>
                    XEQUE V DO CAPRIL VILAR
                </div>
                <div class="animal-item" onclick="setAnimal('1643218013')">
                    <strong>1643218013</strong><br>
                    Animal do Capril Vilar
                </div>
                <div class="animal-item" onclick="setAnimal('1643218014')">
                    <strong>1643218014</strong><br>
                    Animal do Capril Vilar
                </div>
                <div class="animal-item" onclick="setAnimal('1643218015')">
                    <strong>1643218015</strong><br>
                    Animal do Capril Vilar
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h3>1. Autentica√ß√£o</h3>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" value="albertovilar1@gmail.com" required>
            </div>
            
            <div class="form-group">
                <label for="password">Senha:</label>
                <input type="password" id="password" value="132747" required>
            </div>
            
            <button onclick="doLogin()">üîê Fazer Login</button>
            
            <div id="tokenDisplay" class="token-display" style="display: none;">
                <strong>Token JWT:</strong><br>
                <span id="tokenValue"></span>
            </div>
        </div>
        
        <div class="form-section">
            <h3>2. Teste de Genealogia</h3>
            <div class="form-group">
                <label for="animalRegistration">N√∫mero de Registro do Animal:</label>
                <input type="text" id="animalRegistration" placeholder="Ex: 1643218012" required>
            </div>
            
            <div class="button-group">
                <button onclick="createGenealogy()" class="secondary">üß¨ Criar Genealogia</button>
                <button onclick="getGenealogy()">üìã Consultar Genealogia</button>
                <button onclick="clearResults()" class="danger">üóëÔ∏è Limpar Resultados</button>
            </div>
        </div>
        
        <div id="result"></div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:8080/api';
        let authToken = null;
        
        function setAnimal(registration) {
            document.getElementById('animalRegistration').value = registration;
        }
        
        async function doLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            
            try {
                showResult('üîÑ Fazendo login...', 'info');
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });
                
                const responseText = await response.text();
                
                if (response.ok) {
                    const data = JSON.parse(responseText);
                    authToken = data.accessToken;
                    
                    // Mostrar token
                    document.getElementById('tokenValue').textContent = authToken;
                    document.getElementById('tokenDisplay').style.display = 'block';
                    
                    showResult(`‚úÖ LOGIN REALIZADO COM SUCESSO!\n\nUsu√°rio: ${data.user.name}\nEmail: ${data.user.email}\nToken obtido e salvo para pr√≥ximas requisi√ß√µes.`, 'success');
                } else {
                    showResult(`‚ùå ERRO NO LOGIN!\n\nStatus: ${response.status}\nResposta: ${responseText}`, 'error');
                }
                
            } catch (error) {
                showResult(`‚ùå ERRO DE CONEX√ÉO!\n\nErro: ${error.message}`, 'error');
            }
        }
        
        async function createGenealogy() {
            const registration = document.getElementById('animalRegistration').value;
            
            if (!authToken) {
                showResult('‚ùå Fa√ßa login primeiro!', 'error');
                return;
            }
            
            if (!registration) {
                showResult('‚ùå Informe o n√∫mero de registro do animal!', 'error');
                return;
            }
            
            try {
                showResult(`üîÑ Criando genealogia para o animal ${registration}...`, 'info');
                
                const response = await fetch(`${API_BASE}/genealogies/${registration}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                const responseText = await response.text();
                
                if (response.ok) {
                    const data = JSON.parse(responseText);
                    showResult(`‚úÖ GENEALOGIA CRIADA COM SUCESSO!\n\n${formatGenealogyData(data)}`, 'success');
                } else {
                    showResult(`‚ùå ERRO AO CRIAR GENEALOGIA!\n\nStatus: ${response.status}\nResposta: ${responseText}`, 'error');
                }
                
            } catch (error) {
                showResult(`‚ùå ERRO DE CONEX√ÉO!\n\nErro: ${error.message}`, 'error');
            }
        }
        
        async function getGenealogy() {
            const registration = document.getElementById('animalRegistration').value;
            
            if (!registration) {
                showResult('‚ùå Informe o n√∫mero de registro do animal!', 'error');
                return;
            }
            
            try {
                showResult(`üîÑ Consultando genealogia do animal ${registration}...`, 'info');
                
                const response = await fetch(`${API_BASE}/genealogies/${registration}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const responseText = await response.text();
                
                if (response.ok) {
                    const data = JSON.parse(responseText);
                    showResult(`‚úÖ GENEALOGIA ENCONTRADA!\n\n${formatGenealogyData(data)}`, 'success');
                } else {
                    showResult(`‚ùå ERRO AO CONSULTAR GENEALOGIA!\n\nStatus: ${response.status}\nResposta: ${responseText}`, 'error');
                }
                
            } catch (error) {
                showResult(`‚ùå ERRO DE CONEX√ÉO!\n\nErro: ${error.message}`, 'error');
            }
        }
        
        function formatGenealogyData(data) {
            let result = `ANIMAL: ${data.animalName || 'N/A'} (${data.animalRegistration})\n`;
            result += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
            
            // Pais
            result += `üë® PAI: ${data.paternalFatherName || 'N/A'} (${data.paternalFatherRegistration || 'N/A'})\n`;
            result += `üë© M√ÉE: ${data.maternalMotherName || 'N/A'} (${data.maternalMotherRegistration || 'N/A'})\n\n`;
            
            // Av√≥s Paternos
            result += `AV√ìS PATERNOS:\n`;
            result += `  üë¥ ${data.paternalGrandfatherName || 'N/A'} (${data.paternalGrandfatherRegistration || 'N/A'})\n`;
            result += `  üëµ ${data.paternalGrandmotherName || 'N/A'} (${data.paternalGrandmotherRegistration || 'N/A'})\n\n`;
            
            // Av√≥s Maternos
            result += `AV√ìS MATERNOS:\n`;
            result += `  üë¥ ${data.maternalGrandfatherName || 'N/A'} (${data.maternalGrandfatherRegistration || 'N/A'})\n`;
            result += `  üëµ ${data.maternalGrandmotherName || 'N/A'} (${data.maternalGrandmotherRegistration || 'N/A'})\n\n`;
            
            // Bisav√≥s Paternos
            result += `BISAV√ìS PATERNOS:\n`;
            result += `  Lado do Av√¥: ${data.paternalGreatGrandfather1Name || 'N/A'} (${data.paternalGreatGrandfather1Registration || 'N/A'}) + ${data.paternalGreatGrandmother1Name || 'N/A'} (${data.paternalGreatGrandmother1Registration || 'N/A'})\n`;
            result += `  Lado da Av√≥: ${data.paternalGreatGrandfather2Name || 'N/A'} (${data.paternalGreatGrandfather2Registration || 'N/A'}) + ${data.paternalGreatGrandmother2Name || 'N/A'} (${data.paternalGreatGrandmother2Registration || 'N/A'})\n\n`;
            
            // Bisav√≥s Maternos
            result += `BISAV√ìS MATERNOS:\n`;
            result += `  Lado do Av√¥: ${data.maternalGreatGrandfather1Name || 'N/A'} (${data.maternalGreatGrandfather1Registration || 'N/A'}) + ${data.maternalGreatGrandmother1Name || 'N/A'} (${data.maternalGreatGrandmother1Registration || 'N/A'})\n`;
            result += `  Lado da Av√≥: ${data.maternalGreatGrandfather2Name || 'N/A'} (${data.maternalGreatGrandfather2Registration || 'N/A'}) + ${data.maternalGreatGrandmother2Name || 'N/A'} (${data.maternalGreatGrandmother2Registration || 'N/A'})\n`;
            
            return result;
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }
        
        function clearResults() {
            document.getElementById('result').innerHTML = '';
        }
        
        // Auto-focus no primeiro campo
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('email').focus();
        });
    </script>
</body>
</html>